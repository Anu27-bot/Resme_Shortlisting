<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Shortlisting - RS_PROJECT</title>
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Navigation */
        nav {
            background-color: #2c3e50;
            padding: 1rem;
        }
        
        nav ul {
            list-style: none;
            display: flex;
        }
        
        nav ul li a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        nav ul li a:hover {
            background-color: #34495e;
        }
        
        /* Header */
        header {
            background-color: #3498db;
            color: white;
            text-align: center;
            padding: 2rem 1rem;
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        /* Main container */
        .container {
            flex: 1;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        
        /* Form styles */
        .form-group {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        .form-group input[type="text"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            margin-bottom: 1rem;
        }
        
        .form-group button {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        .form-group button:hover {
            background-color: #27ae60;
        }
        
        /* Job info sections */
        .job-info {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
            border-left: 4px solid #3498db;
        }
        
        .job-info h3 {
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }
        
        /* Table controls */
        .table-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }
        
        #rank-search {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
        }
        
        #download-csv {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        #download-csv:hover {
            background-color: #2980b9;
        }
        
        .results-count {
            margin-left: auto;
            font-weight: 600;
            color: #2c3e50;
        }
        
        /* Table styles */
        .table-wrapper {
            max-height: 600px;
            overflow-y: auto;
            margin-bottom: 2rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            background: white;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .results-table th, 
        .results-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .results-table th {
            background-color: #34495e;
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
            font-weight: 600;
        }
        
        .results-table tr:hover {
            background-color: #f5f5f5;
        }
        
        /* Skill badges */
        .skill-badge {
            display: inline-block;
            background-color: #e8f4fc;
            color: #2c3e50;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            margin: 0.1rem;
            font-size: 0.85em;
        }
        
        .skill-count {
            font-weight: bold;
            color: #3498db;
        }
        
        /* Footer */
        footer {
            background-color: #2c3e50;
            color: white;
            text-align: center;
            padding: 1rem;
            margin-top: auto;
        }
        
        /* Loading indicator */
        #loading-indicator {
            text-align: center;
            margin: 2rem 0;
            display: none;
        }
        
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Flash messages */
        .error {
            background-color: #ffebee;
            color: #c62828;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            border-left: 4px solid #c62828;
        }
        
        .success {
            background-color: #e8f5e9;
            color: #2e7d32;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            border-left: 4px solid #2e7d32;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .table-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            #rank-search {
                width: 100%;
            }
            
            .results-count {
                margin-left: 0;
                margin-top: 1rem;
            }
            
            .table-wrapper {
                overflow-x: auto;
            }
            
            .results-table {
                min-width: 800px;
            }
        }
        
        /* Recent jobs section */
        .recent-jobs {
            margin-top: 1rem;
        }
        
        .recent-jobs h4 {
            margin-bottom: 0.5rem;
            color: #2c3e50;
        }
        
        .job-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .job-tag {
            background-color: #e8f4fc;
            color: #3498db;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }
        
        .job-tag:hover {
            background-color: #d1ebff;
        }
        
        /* Highlight top candidates */
        .top-candidate {
            background-color: #f0f9eb;
        }
        
        .top-candidate:hover {
            background-color: #e1f5d4;
        }
        
        /* Job ID history */
        .job-history {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
        }
        
        .job-history h4 {
            margin-bottom: 0.5rem;
            color: #2c3e50;
        }
        
        .history-list {
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 0.5rem;
            background-color: #f9f9f9;
        }
        
        .history-item {
            padding: 0.5rem;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
        }
        
        .history-item:hover {
            background-color: #e8f4fc;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-remove {
            color: #e74c3c;
            cursor: pointer;
            padding: 0 0.25rem;
        }
    </style>
</head>
<body>
    <nav>
        <ul>
            <li><a href="#" style="display: flex; align-items: center; gap: 5px;">Home üè†</a></li>
        </ul>
    </nav>
    <header>
        <h1>Resume Shortlisting Process</h1>
        <p>Enter any Job ID to process and rank candidates</p>
    </header>
    <div class="container">
        <div class="section" id="process">
            <h2>Enter Job ID</h2>
            <div class="form-group">
                <label>Job ID:</label>
                <input type="text" id="job-id-input" placeholder="e.g., NC-774172, VA-12345, TX-98765, or any other ID" required>
                <button type="button" onclick="processJobId()">Process Resumes</button>
                
                <div class="recent-jobs">
                    <h4>Example Job IDs:</h4>
                    <div class="job-tags">
                        <span class="job-tag" onclick="setJobId('NC-774172')">NC-774172</span>
                        <span class="job-tag" onclick="setJobId('VA-12345')">VA-12345</span>
                        <span class="job-tag" onclick="setJobId('TX-98765')">TX-98765</span>
                        <span class="job-tag" onclick="setJobId('CA-54321')">CA-54321</span>
                    </div>
                </div>
                
                <div class="job-history">
                    <h4>Your Recent Job IDs:</h4>
                    <div class="history-list" id="job-history-list">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>
            <div id="loading-indicator">
                <div class="loader"></div>
                <p id="loading-message">Processing...</p>
            </div>

            <div id="job-role-container" class="job-info" style="display: none;">
                <h3>Job Role:</h3>
                <p id="job-role-text"></p>
            </div>

            <div id="subject-skills-container" class="job-info" style="display: none;">
                <h3>Subject Skills:</h3>
                <p id="subject-skills-text"></p>
            </div>
            
            <div id="results-container" style="display: none;">
                <div class="table-controls">
                    <input type="number" id="rank-search" placeholder="Search by Rank" oninput="filterTableByRank()" min="1">
                    <button id="download-csv" onclick="downloadCSV()">Download as CSV üì•</button>
                    <div class="results-count" id="results-count"></div>
                </div>
                <div class="table-wrapper">
                    <table class="results-table" id="results-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Name</th>
                                <th>Current Location</th>
                                <th>Experience</th>
                                <th>Certification Count</th>
                                <th>Government Work</th>
                                <th>Matching Skills</th>
                                <th>Matching Skills Count</th>
                            </tr>
                        </thead>
                        <tbody id="table-body">
                            <!-- Table rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div id="no-results" class="job-info" style="display: none;">
                <h3>Processing Status</h3>
                <p>No results yet. Process a job to see candidate rankings.</p>
            </div>
        </div>
    </div>
    <footer>
        <p>¬© 2025 RS_PROJECT. All rights reserved.</p>
    </footer>

    <script>
    // Initialize job history from localStorage
    let jobHistory = JSON.parse(localStorage.getItem('jobHistory')) || [];
    updateJobHistoryDisplay();
    
    // Set job ID from recent jobs
    function setJobId(jobId) {
        document.getElementById('job-id-input').value = jobId;
    }
    
    // Update job history display
    function updateJobHistoryDisplay() {
        const historyList = document.getElementById('job-history-list');
        historyList.innerHTML = '';
        
        if (jobHistory.length === 0) {
            historyList.innerHTML = '<div class="history-item">No recent jobs yet</div>';
            return;
        }
        
        // Show most recent first
        const reversedHistory = [...jobHistory].reverse();
        
        reversedHistory.forEach(jobId => {
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            historyItem.innerHTML = `
                <span onclick="setJobId('${jobId}'); processJobId()">${jobId}</span>
                <span class="history-remove" onclick="removeFromHistory('${jobId}')">‚úï</span>
            `;
            historyList.appendChild(historyItem);
        });
    }
    
    // Add job ID to history
    function addToHistory(jobId) {
        // Remove if already exists to avoid duplicates
        jobHistory = jobHistory.filter(id => id !== jobId);
        
        // Add to history (max 10 items)
        jobHistory.push(jobId);
        if (jobHistory.length > 10) {
            jobHistory = jobHistory.slice(jobHistory.length - 10);
        }
        
        // Save to localStorage
        localStorage.setItem('jobHistory', JSON.stringify(jobHistory));
        updateJobHistoryDisplay();
    }
    
    // Remove job ID from history
    function removeFromHistory(jobId) {
        jobHistory = jobHistory.filter(id => id !== jobId);
        localStorage.setItem('jobHistory', JSON.stringify(jobHistory));
        updateJobHistoryDisplay();
    }

    // Process the entered Job ID
    function processJobId() {
        const jobId = document.getElementById('job-id-input').value.trim();
        
        if (!jobId) {
            showError('Please enter a Job ID');
            return;
        }
        
        // Add to history
        addToHistory(jobId);
        
        const loadingIndicator = document.getElementById('loading-indicator');
        const loadingMessage = document.getElementById('loading-message');
        loadingIndicator.style.display = 'block';

        // Hide previous results and errors
        document.getElementById('job-role-container').style.display = 'none';
        document.getElementById('subject-skills-container').style.display = 'none';
        document.getElementById('results-container').style.display = 'none';
        document.getElementById('no-results').style.display = 'none';
        
        const existingErrors = document.querySelectorAll('.error');
        existingErrors.forEach(error => error.remove());

        // Loading messages
        const messages = [
            "Processing Job ID...",
            "Clearing previous resumes...",
            "Accessing Gmail...",
            "Filtering emails by Job ID...",
            "Downloading resumes from attachments...",
            "Converting resumes (.pdf & .docx) into text (.txt)...",
            "Extracting the details or columns..."
        ];

        // Cycle through messages
        let messageIndex = 0;
        loadingMessage.textContent = messages[messageIndex];
        const interval = setInterval(() => {
            messageIndex = (messageIndex + 1) % messages.length;
            loadingMessage.textContent = messages[messageIndex];
        }, 1500);

        // Call the backend API - using a mock for demonstration
        // In a real application, this would be: fetch(`/api/process/${jobId}`)
        simulateApiCall(jobId)
            .then(data => {
                clearInterval(interval);
                loadingIndicator.style.display = 'none';
                
                if (data.success) {
                    displayJobData(data);
                } else {
                    showError(data.error || `No data found for Job ID: ${jobId}`);
                }
            })
            .catch(error => {
                clearInterval(interval);
                loadingIndicator.style.display = 'none';
                showError(`Error processing Job ID: ${error.message}`);
            });
    }
    
    // Simulate API call with mock data for demonstration
    function simulateApiCall(jobId) {
        return new Promise((resolve, reject) => {
            setTimeout(() => {
                // Generate mock data based on job ID
                const skillsPool = [
                    "JavaScript", "Python", "Java", "C#", "React", "Angular", "Vue", 
                    "Node.js", "SQL", "MongoDB", "AWS", "Azure", "Docker", "Kubernetes",
                    "Machine Learning", "Data Analysis", "UI/UX Design", "Project Management"
                ];
                
                // Select 5-8 random skills for this job
                const jobSkills = [];
                const numSkills = Math.floor(Math.random() * 4) + 5;
                for (let i = 0; i < numSkills; i++) {
                    const randomIndex = Math.floor(Math.random() * skillsPool.length);
                    if (!jobSkills.includes(skillsPool[randomIndex])) {
                        jobSkills.push(skillsPool[randomIndex]);
                    }
                }
                
                // Generate random candidates
                const candidates = [];
                const numCandidates = Math.floor(Math.random() * 15) + 10; // 10-25 candidates
                const locations = ["New York, NY", "San Francisco, CA", "Austin, TX", "Chicago, IL", "Boston, MA", "Remote"];
                const govWorkOptions = ["Yes", "No", "Partial"];
                
                for (let i = 1; i <= numCandidates; i++) {
                    // Select 2-5 matching skills for this candidate
                    const matchingSkills = [];
                    const numMatching = Math.floor(Math.random() * 4) + 2;
                    for (let j = 0; j < numMatching; j++) {
                        const randomIndex = Math.floor(Math.random() * jobSkills.length);
                        if (!matchingSkills.includes(jobSkills[randomIndex])) {
                            matchingSkills.push(jobSkills[randomIndex]);
                        }
                    }
                    
                    candidates.push({
                        Rank: i,
                        Name: `Candidate ${i}`,
                        "Current Location": locations[Math.floor(Math.random() * locations.length)],
                        Experience: `${Math.floor(Math.random() * 15) + 2} years`,
                        "Certification Count": Math.floor(Math.random() * 8),
                        "Government Work": govWorkOptions[Math.floor(Math.random() * govWorkOptions.length)],
                        "Matching Skills": matchingSkills,
                        "Matching Skills Count": matchingSkills.length
                    });
                }
                
                resolve({
                    success: true,
                    job_id: jobId,
                    job_role: `Role for ${jobId}`,
                    subject_skills: jobSkills,
                    candidates: candidates
                });
            }, 3000); // Simulate 3 second API delay
        });
    }

    // Display job data from API response
    function displayJobData(data) {
        // Hide no results message
        document.getElementById('no-results').style.display = 'none';
        
        // Show job role
        document.getElementById('job-role-text').textContent = data.job_role;
        document.getElementById('job-role-container').style.display = 'block';
        
        // Show subject skills
        const skillsContainer = document.getElementById('subject-skills-text');
        skillsContainer.innerHTML = '';
        if (data.subject_skills && data.subject_skills.length > 0) {
            data.subject_skills.forEach(skill => {
                const skillBadge = document.createElement('span');
                skillBadge.className = 'skill-badge';
                skillBadge.textContent = skill;
                skillsContainer.appendChild(skillBadge);
            });
        } else {
            skillsContainer.textContent = 'No skills specified';
        }
        document.getElementById('subject-skills-container').style.display = 'block';
        
        // Show candidate data
        const tableBody = document.getElementById('table-body');
        tableBody.innerHTML = '';
        
        data.candidates.forEach(candidate => {
            const row = document.createElement('tr');
            
            // Add highlight for top 3 candidates
            if (candidate.Rank <= 3) {
                row.className = 'top-candidate';
            }
            
            // Format matching skills
            let skillsHtml = 'N/A';
            if (candidate['Matching Skills'] && candidate['Matching Skills'] !== 'N/A') {
                if (Array.isArray(candidate['Matching Skills'])) {
                    skillsHtml = candidate['Matching Skills'].map(skill => 
                        `<span class="skill-badge">${skill}</span>`
                    ).join('');
                } else if (typeof candidate['Matching Skills'] === 'string') {
                    skillsHtml = candidate['Matching Skills'];
                }
            }
            
            // Add candidate data to row
            row.innerHTML = `
                <td>${candidate.Rank || 'N/A'}</td>
                <td>${candidate.Name || 'N/A'}</td>
                <td>${candidate['Current Location'] || 'N/A'}</td>
                <td>${candidate.Experience || 'N/A'}</td>
                <td>${candidate['Certification Count'] || 'N/A'}</td>
                <td>${candidate['Government Work'] || 'N/A'}</td>
                <td>${skillsHtml}</td>
                <td class="skill-count">${candidate['Matching Skills Count'] || 0}</td>
            `;
            
            tableBody.appendChild(row);
        });
        
        // Show results container
        document.getElementById('results-container').style.display = 'block';
        
        // Update results count
        document.getElementById('results-count').textContent = 
            `Showing ${data.candidates.length} candidates`;
        
        // Store current job data for CSV download
        window.currentJobData = data;
        
        // Clear search filter
        document.getElementById('rank-search').value = '';
    }

    // Show error message
    function showError(message) {
        document.getElementById('job-role-container').style.display = 'none';
        document.getElementById('subject-skills-container').style.display = 'none';
        document.getElementById('results-container').style.display = 'none';
        document.getElementById('no-results').style.display = 'block';
        
        // Show error message
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error';
        errorDiv.textContent = message;
        
        // Remove any existing error messages
        const existingErrors = document.querySelectorAll('.error');
        existingErrors.forEach(error => error.remove());
        
        document.querySelector('.form-group').appendChild(errorDiv);
    }

    // Filter table by rank
    function filterTableByRank() {
        const rankInput = document.getElementById('rank-search').value.trim();
        const tableBody = document.getElementById('table-body');
        const rows = tableBody.getElementsByTagName('tr');
        let visibleCount = 0;

        for (let i = 0; i < rows.length; i++) {
            const rankCell = rows[i].getElementsByTagName('td')[0];
            if (rankCell) {
                const rankValue = rankCell.textContent || rankCell.innerText;
                if (rankInput === '' || rankValue === rankInput) {
                    rows[i].style.display = '';
                    visibleCount++;
                } else {
                    rows[i].style.display = 'none';
                }
            }
        }
        
        // Update results count
        document.getElementById('results-count').textContent = 
            `Showing ${visibleCount} of ${rows.length} candidates`;
    }

    // Download the entire table as CSV
    function downloadCSV() {
        if (!window.currentJobData) {
            alert('No data available to download. Please process a Job ID first.');
            return;
        }
        
        let csvContent = '';
        const data = window.currentJobData;

        // Add job ID section
        csvContent += 'Job ID\n';
        csvContent += data.job_id + '\n\n';

        // Add job role section
        csvContent += 'Job Role\n';
        csvContent += data.job_role + '\n\n';

        // Add subject skills section
        csvContent += 'Subject Skills\n';
        csvContent += data.subject_skills.join(', ') + '\n\n';

        // Add table data section
        csvContent += 'Candidate Details\n';
        csvContent += 'Rank,Name,Current Location,Experience,Certification Count,Government Work,Matching Skills,Matching Skills Count\n';
        
        data.candidates.forEach(candidate => {
            const row = [
                candidate.Rank || '',
                `"${candidate.Name || ''}"`,
                `"${candidate['Current Location'] || ''}"`,
                `"${candidate.Experience || ''}"`,
                candidate['Certification Count'] || '',
                `"${candidate['Government Work'] || ''}"`,
                `"${(candidate['Matching Skills'] && typeof candidate['Matching Skills'] === 'string') ? 
                    candidate['Matching Skills'] : 
                    (Array.isArray(candidate['Matching Skills']) ? candidate['Matching Skills'].join('; ') : '')}"`,
                candidate['Matching Skills Count'] || ''
            ];
            csvContent += row.join(',') + '\n';
        });

        // Create a blob and trigger download
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', `candidate_details_${data.job_id}.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
    
    // Allow pressing Enter to process the Job ID
    document.getElementById('job-id-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            processJobId();
        }
    });
</script>
</body>
</html>
